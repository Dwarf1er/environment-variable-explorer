@page "/"
@using EnvironmentVariableExplorer.Models
@using EnvironmentVariableExplorer.Shared
@inherits ComponentBase

<MudTable
Items="@FilteredEnvironmentVariables"
Hover="@_hover"
CanCancelEdit="@_canCancelEdit"
@bind-SelectedItem="@_selectedEnvironmentVariable"
FixedHeader="@_fixedHeader"
Filter="new Func<EnvironmentVariable, bool>(SearchEnvironmentVariables)"
CommitEditTooltip="Commit Edit"
RowEditPreview="BackupItem"
RowEditCancel="ResetItemToOriginalValues"
RowEditCommit="ItemHasBeenCommitted"
ApplyButtonPosition="@_applyButtonPosition"
EditButtonPosition="@_editButtonPosition"
EditTrigger="@_editTrigger"
Height="79vh"
@ref="_mudTable"
>
    <ToolBarContent>
        <MudSelect @bind-Value="_selectedEnvironmentVariableTarget" @bind-Value:after="OnEnvironmentVariableTargetChanged" Placeholder="Select Target">
            @foreach (EnvironmentVariableTargetSelectionOption environmentVariableTarget in _availableEnvironmentVariableTargets)
            {
                <MudSelectItem Value="environmentVariableTarget">@environmentVariableTarget.ToString()</MudSelectItem>
            }
        </MudSelect>
        <MudSpacer />
        <MudTextField @bind-Value="_searchString" Placeholder="@Resources.Strings.Search" Immediate="true" Adornment="Adornment.Start" AdornmentIcon="@Icons.Material.Filled.Search" IconSize="Size.Medium"></MudTextField>
        <MudFab OnClick="AddRowAsync" Color="Color.Primary" Size="Size.Small" StartIcon="@Icons.Material.Filled.Add" />
    </ToolBarContent>
    <HeaderContent>
        <MudTh>@Resources.Strings.Name</MudTh>
        <MudTh>@Resources.Strings.Value</MudTh>
        <MudTh>@Resources.Strings.Target</MudTh>
    </HeaderContent>
    <RowTemplate>
        <MudTd>@context.Name</MudTd>
        <MudTd Style="overflow-wrap:break-word;max-width:200px;">@context.Value</MudTd>
        <MudTd>@context.Target</MudTd>
    </RowTemplate>
    <RowEditingTemplate>
        <MudTd>
            <MudTextField T="string" @bind-Value="context.Name" Required @ref="_mudTextField" />
        </MudTd>
        <MudTd Style="overflow-wrap:break-word;max-width:200px;">
            <MudTextField T="string" @bind-Value="context.Value" Required />
        </MudTd>
        <MudTd>@context.Target</MudTd>
        <MudTd>
            <MudIconButton OnClick="@(() => DeleteRowAsync(context))" Variant="Variant.Filled" Icon="@Icons.Material.Filled.Delete" Color="Color.Error" />
        </MudTd>
    </RowEditingTemplate>
</MudTable>
